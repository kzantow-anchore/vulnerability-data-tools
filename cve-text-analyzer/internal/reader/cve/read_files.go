package cve

import (
	"encoding/json"
	"os"

	"github.com/bmatcuk/doublestar/v4"

	"github.com/anchore/go-sync"
	"github.com/anchore/vulnerability-data-tools/cve-text-analyzer/internal/util"
)

func ReadFiles(glob string) []Record {
	paths := util.Get(doublestar.FilepathGlob(glob))
	collector := sync.NewCollector[Record](sync.NewExecutor(8))
	for _, p := range paths {
		p := p
		collector.Provide(func() Record {
			var cveRec Record
			util.Log(json.Unmarshal(util.Get(os.ReadFile(p)), &cveRec))
			return cveRec
		})
	}
	return collector.Collect()
}
