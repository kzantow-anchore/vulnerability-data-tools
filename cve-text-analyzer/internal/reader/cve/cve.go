package cve

import (
	"github.com/anchore/grype-db/pkg/provider/unmarshal/nvd/cvss31"
)

const StateRejected = "REJECTED"

type Record struct {
	Metadata   Metadata   `json:"cveMetadata"`
	Containers Containers `json:"containers"`
}

type Metadata struct {
	ID        string `json:"cveId"`
	State     string `json:"state"`
	Published string `json:"datePublished"`
	Updated   string `json:"dateUpdated"`
}

type Containers struct {
	Cna Cna `json:"cna"`
}

type Cna struct {
	Affected     []Affected  `json:"affected"`
	References   []Reference `json:"references"`
	Descriptions []Text      `json:"descriptions"`
	Metrics      []Metrics   `json:"metrics"`
}

type Affected struct {
	Vendor      string    `json:"vendor"`
	Product     string    `json:"product"`
	PackageName string    `json:"packageName"`
	Versions    []Version `json:"versions"`
	Cpes        []string  `json:"cpes"`
}

type Reference struct {
	Url string `json:"url"`
}

type Text struct {
	Lang  string `json:"lang"`
	Value string `json:"value"`
}

type Metrics struct {
	cvss31.Cvss31 `json:"cvssV3_1"`
}

// https://cveproject.github.io/cve-schema/schema/v5.0/docs/#oneOf_i0_containers_cna_affected_items_versions
type Version struct {
	Version         string          `json:"version"`
	Status          string          `json:"status"`
	VersionType     string          `json:"versionType"`
	LessThan        string          `json:"lessThan"`
	LessThanOrEqual string          `json:"lessThanOrEqual"`
	Changes         []VersionChange `json:"changes"`
}

type VersionChange struct {
	At     string `json:"at"`
	Status string `json:"status"`
}
